<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Registro de Ponto</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container mt-5">
    <h1 class="text-center mb-4">📋 Registro de Ponto</h1>


    <!-- Registrar ponto -->
    <div class="card mb-4">
      <div class="card-header bg-secondary text-white">Registrar Ponto</div>
      <div class="card-body">
        <form id="form-ponto">
          <div class="mb-3">
            <label class="form-label">ID do Funcionário</label>
            <input type="number" id="funcionario_id" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Tipo</label>
            <select id="tipo" class="form-select" required>
              <option value="entrada">Entrada</option>
              <option value="saida">Saída</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Registrar</button>
        </form>
      </div>
    </div>

    <!-- Listar registros -->
    <div class="card">
      <div class="card-header bg-dark text-white">Registros de Ponto</div>
      <div class="card-body">
        <form id="form-listar" class="mb-3">
          <label class="form-label">ID do Funcionário</label>
          <input type="number" id="funcionario_id_listar" class="form-control mb-2" required>
          <button type="submit" class="btn btn-info">Listar</button>
        </form>
        <ul id="lista-registros" class="list-group"></ul>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "http://127.0.0.1:5000"; // ajuste se necessário

    // Cadastrar funcionário
    document.getElementById("form-funcionario").addEventListener("submit", async (e) => {
      e.preventDefault();
      const nome = document.getElementById("nome").value;

      const res = await fetch(`${API_URL}/funcionarios`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nome })
      });

      const data = await res.json();
      alert(`Funcionário cadastrado: ${data.nome} (ID: ${data.id})`);
    });

    // Registrar ponto
    document.getElementById("form-ponto").addEventListener("submit", async (e) => {
      e.preventDefault();
      const funcionario_id = document.getElementById("funcionario_id").value;
      const tipo = document.getElementById("tipo").value;

      const res = await fetch(`${API_URL}/ponto`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ funcionario_id, tipo })
      });

      const data = await res.json();
      if (res.ok) {
        alert(`Ponto registrado: ${data.tipo} às ${data.timestamp}`);
      } else {
        alert(`Erro: ${data.erro}`);
      }
    });

    // Listar registros
    document.getElementById("form-listar").addEventListener("submit", async (e) => {
      e.preventDefault();
      const funcionario_id = document.getElementById("funcionario_id_listar").value;

      const res = await fetch(`${API_URL}/ponto/${funcionario_id}`);
      const data = await res.json();

      const lista = document.getElementById("lista-registros");
      lista.innerHTML = "";

      if (res.ok) {
        data.registros.forEach(r => {
          const li = document.createElement("li");
          li.className = "list-group-item";
          li.textContent = `${r.tipo} - ${r.timestamp}`;
          lista.appendChild(li);
        });
      } else {
        alert(`Erro: ${data.erro}`);
      }
    });
  </script>

</body>
</html>
